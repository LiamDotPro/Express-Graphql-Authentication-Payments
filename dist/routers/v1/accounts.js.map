{"version":3,"sources":["../../../routers/v1/accounts.js"],"names":["ExtractJwt","jwtOptions","jwtFromRequest","fromAuthHeaderAsBearerToken","secretOrKey","process","env","JWT_SECRET","router","auth","passport","post","req","res","next","body","email","password","json","message","error","login","then","_res","console","log","payload","id","user","session","key_name","token","sign","expiresIn","get","authenticate","send"],"mappings":";;;;;;AAAA;;AAIA;;;;AACA;;;;AACA;;;;AACA;;;;;;;AANA;;;;;AAQA;AACA,IAAIA,aAAa,sBAAYA,UAA7B;;AAEA;AACA,IAAIC,aAAa,EAAjB;AACAA,WAAWC,cAAX,GAA4BF,WAAWG,2BAAX,EAA5B;AACAF,WAAWG,WAAX,GAAyBC,QAAQC,GAAR,CAAYC,UAArC;;AAEA,IAAMC,SAAS,2BAAf;AACA,IAAMC,OAAO,8BAAb;AACA,IAAMC,WAAW,yBAAyBA,QAA1C;;AAEA;;;AAGAF,OAAOG,IAAP,CAAY,QAAZ;AAAA,uEAAsB,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA,8BACd,CAACF,IAAIG,IAAJ,CAASC,KAAV,IAAmB,CAACJ,IAAIG,IAAJ,CAASE,QADf;AAAA;AAAA;AAAA;;AAEdJ,4BAAIK,IAAJ,CAAS;AACLC,qCAAS,KADJ;AAELC,mCAAO;AAFF,yBAAT;AAFc,yDAMPN,MANO;;AAAA;;AASlBL,6BAAKY,KAAL,CAAWT,IAAIG,IAAJ,CAASC,KAApB,EAA2BJ,IAAIG,IAAJ,CAASE,QAApC,EAA8CK,IAA9C,CAAmD,UAACC,IAAD,EAAU;;AAEzDC,oCAAQC,GAAR,CAAYb,IAAIG,IAAJ,CAASC,KAArB,EAA4BJ,IAAIG,IAAJ,CAASE,QAArC;;AAEA,gCAAIM,KAAKG,OAAL,KAAiB,EAArB,EAAyB;AACrBb,oCAAIK,IAAJ,CAAS;AACLC,6CAAS,KADJ;AAELC,2CAAO;AAFF,iCAAT;AAIA,uCAAON,MAAP;AACH;;AAED,gCAAIY,UAAU;AACVC,oCAAIJ,KAAKK,IAAL,CAAUD;AADJ,6BAAd;;AAIA;AACAf,gCAAIiB,OAAJ,CAAYC,QAAZ,GAAuBP,KAAKK,IAAL,CAAUD,EAAjC;;AAEA;AACA,gCAAII,QAAQ,uBAAIC,IAAJ,CAASN,OAAT,EAAkBzB,WAAWG,WAA7B,EAA0C,EAAC6B,WAAW,KAAK,EAAjB,EAA1C,CAAZ;AACApB,gCAAIK,IAAJ,CAAS,EAACC,SAAS,IAAV,EAAgBY,OAAOA,KAAvB,EAAT;AACA,mCAAOjB,MAAP;AACH,yBAvBD;;AATkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAtB;;AAAA;AAAA;AAAA;AAAA;;AAmCAN,OAAO0B,GAAP,CAAW,UAAX,EAAuBxB,SAASyB,YAAT,CAAsB,KAAtB,EAA6B,EAACN,SAAS,KAAV,EAA7B,CAAvB,EAAuE,UAACjB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACvFD,QAAIK,IAAJ,CAAS,EAACW,SAASjB,IAAIiB,OAAd,EAAT;AACAf;AACH,CAHD;;AAKAN,OAAOG,IAAP,CAAY,GAAZ,EAAiB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjCD,QAAIuB,IAAJ,CAAS,EAAT;AACAtB;AACH,CAHD;;kBAKeN,M","file":"accounts.js","sourcesContent":["import {Router} from 'restify-router';\r\n/**\r\n * Path imports\r\n */\r\nimport Authentication from '../../library/Accounts/authentication';\r\nimport passportJWT from 'passport-jwt';\r\nimport jwt from 'jsonwebtoken';\r\nimport configuredPassport from '../../library/Passport/Passport';\r\n\r\n// Passport Data\r\nlet ExtractJwt = passportJWT.ExtractJwt;\r\n\r\n// token options.\r\nlet jwtOptions = {};\r\njwtOptions.jwtFromRequest = ExtractJwt.fromAuthHeaderAsBearerToken();\r\njwtOptions.secretOrKey = process.env.JWT_SECRET;\r\n\r\nconst router = new Router();\r\nconst auth = new Authentication();\r\nconst passport = new configuredPassport().passport;\r\n\r\n/**\r\n * Routes\r\n */\r\nrouter.post('/login', async (req, res, next) => {\r\n    if (!req.body.email || !req.body.password) {\r\n        res.json({\r\n            message: 'bad',\r\n            error: 'Username or Password not found.'\r\n        });\r\n        return next();\r\n    }\r\n\r\n    auth.login(req.body.email, req.body.password).then((_res) => {\r\n\r\n        console.log(req.body.email, req.body.password);\r\n\r\n        if (_res.payload !== 11) {\r\n            res.json({\r\n                message: 'bad',\r\n                error: 'Username or Password not found.'\r\n            });\r\n            return next();\r\n        }\r\n\r\n        let payload = {\r\n            id: _res.user.id\r\n        };\r\n\r\n        // setup session\r\n        req.session.key_name = _res.user.id;\r\n\r\n        // Sets expiration date\r\n        let token = jwt.sign(payload, jwtOptions.secretOrKey, {expiresIn: 60 * 60});\r\n        res.json({message: 'ok', token: token});\r\n        return next();\r\n    })\r\n});\r\n\r\nrouter.get('/account', passport.authenticate('jwt', {session: false}), (req, res, next) => {\r\n    res.json({session: req.session});\r\n    next();\r\n});\r\n\r\nrouter.post('/', (req, res, next) => {\r\n    res.send({});\r\n    next();\r\n});\r\n\r\nexport default router;"]}