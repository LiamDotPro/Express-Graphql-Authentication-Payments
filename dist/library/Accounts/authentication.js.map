{"version":3,"sources":["../../../library/Accounts/authentication.js"],"names":["authentication","email","password","checkForDuplicateAccount","toLowerCase","then","res","payload","msg","length","encryptPassword","pass","createAccount","validateUser","currPass","newPass","userID","getUserPasswordHash","comparePasswords","hash","status","message","insertNewHashedPassword"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;;;;;AAEA;;;;;;;;IAQqBA,c;;;AAEjB,8BAAc;AAAA;;AAAA;AAEb;;AAED;;;;;;;;;;;;;;;qCAWaC,K,EAAOC,Q,EAAU;AAAA;;AAC1B,mBAAO,KAAKC,wBAAL,CAA8BF,MAAMG,WAAN,EAA9B,EAAmDC,IAAnD,CAAwD,UAACC,GAAD,EAAS;AACpE,oBAAIA,IAAIC,OAAJ,KAAgB,CAApB,EAAuB;AACnB,2BAAO;AACHC,6BAAKF,IAAIE;AADN,qBAAP;AAGH;;AAED,oBAAIN,SAASO,MAAT,IAAmB,CAAvB,EAA0B;AACtB,2BAAO;AACHD,6BAAK;AADF,qBAAP;AAGH;;AAED,uBAAO,OAAKE,eAAL,CAAqBR,QAArB,EAA+BG,IAA/B,CAAoC,UAACM,IAAD,EAAU;AACjD,2BAAO,OAAKC,aAAL,CAAmBX,MAAMG,WAAN,EAAnB,EAAwCO,IAAxC,EAA8CN,IAA9C,CAAmD,YAAM;AAC5D,+BAAO;AACHG,iCAAK,sBADF;AAEHD,qCAASD,IAAIC;AAFV,yBAAP;AAIH,qBALM,CAAP;AAMH,iBAPM,CAAP;AAQH,aArBM,CAAP;AAsBH;;AAED;;;;;;;;;;8BAOMN,K,EAAOC,Q,EAAU;AACnB,mBAAO,KAAKW,YAAL,CAAkBZ,KAAlB,EAAyBC,QAAzB,EAAmCG,IAAnC,CAAwC,UAACC,GAAD,EAAS;AACpD,uBAAOA,GAAP;AACH,aAFM,CAAP;AAGH;;AAGD;;;;;;;;;;2CAOmBQ,Q,EAAUC,O,EAASC,M,EAAQ;AAAA;;AAC1C,mBAAO,KAAKC,mBAAL,CAAyBD,MAAzB,EAAiCX,IAAjC,CAAsC,UAACC,GAAD,EAAS;AAClD,uBAAO,OAAKY,gBAAL,CAAsBZ,IAAIa,IAA1B,EAAgCL,QAAhC,CAAP;AACH,aAFM,EAEJT,IAFI,CAEC,UAACC,GAAD,EAAS;AACb,oBAAI,CAACA,GAAL,EAAU;AACN,2BAAO;AACHc,gCAAQ,KADL;AAEHC,iCAAS;AAFN,qBAAP;AAIH;AACD,uBAAO,OAAKC,uBAAL,CAA6BN,MAA7B,EAAqCD,OAArC,CAAP;AACH,aAVM,CAAP;AAWH;;;;;;kBA3EgBf,c","file":"authentication.js","sourcesContent":["import Promise from 'bluebird';\r\nimport baseUserFunctions from \"./authenticationBase\";\r\n\r\n/**\r\n * Payload Numbering\r\n *\r\n * 0 Success\r\n * 1 Failure\r\n * 10 Account Creation\r\n * 11 Successful Login\r\n */\r\nexport default class authentication extends baseUserFunctions {\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * List of error handling and checks.\r\n     *\r\n     * Duplicate Entry Test\r\n     * length Test\r\n     * @todo test with postman for if extra length is needed, also implementing special char check regexp\r\n     * @param email\r\n     * @param password\r\n     * @returns {Promise.<TResult>}\r\n     * @constructor\r\n     */\r\n    registerUser(email, password) {\r\n        return this.checkForDuplicateAccount(email.toLowerCase()).then((res) => {\r\n            if (res.payload !== 0) {\r\n                return {\r\n                    msg: res.msg\r\n                }\r\n            }\r\n\r\n            if (password.length >= 6) {\r\n                return {\r\n                    msg: 'Password not long enough'\r\n                }\r\n            }\r\n\r\n            return this.encryptPassword(password).then((pass) => {\r\n                return this.createAccount(email.toLowerCase(), pass).then(() => {\r\n                    return {\r\n                        msg: 'New Account Created.',\r\n                        payload: res.payload\r\n                    }\r\n                })\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Separate method from the attempt to validate specifically so we can add extra\r\n     * checks and further integration later if without worrying about moving stuff\r\n     * to methods.\r\n     * @param email\r\n     * @param password\r\n     */\r\n    login(email, password) {\r\n        return this.validateUser(email, password).then((res) => {\r\n            return res;\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * Updates a users password provided they pass the original current password.\r\n     * @param currPass\r\n     * @param newPass\r\n     * @param userID\r\n     * @returns {Bluebird<any> | Promise.<TResult>}\r\n     */\r\n    updateUserPassword(currPass, newPass, userID) {\r\n        return this.getUserPasswordHash(userID).then((res) => {\r\n            return this.comparePasswords(res.hash, currPass);\r\n        }).then((res) => {\r\n            if (!res) {\r\n                return {\r\n                    status: 'err',\r\n                    message: 'Current Password does not match'\r\n                }\r\n            }\r\n            return this.insertNewHashedPassword(userID, newPass);\r\n        });\r\n    }\r\n\r\n}\r\n"]}