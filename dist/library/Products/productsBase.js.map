{"version":3,"sources":["../../../library/Products/productsBase.js"],"names":["require","config","products","product","productsBase","process","env","ENVIROMENT","new","target","TypeError","findAll","allProducts","length","msg","payload","productList","map","item","index","arr","dataValues","id","where","name","description","thumbnail","dispatchTime","status","eligibleForDiscount","productInventory","startSaleDate","endSaleDate","create","productName","productDesc","productThumbnail","productDispatchTime","startSale","endSale","createdProduct","insertedId","page","findAndCountAll","then","data","count","limit","pages","Math","ceil","offset","order","resultObjects","outputProducts","update","updatedProduct","destroy"],"mappings":"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","file":"productsBase.js","sourcesContent":["require('dotenv').config();\r\nimport 'babel-polyfill';\r\n// Database Class.\r\nimport db from '../../models/index';\r\n// Products model\r\nconst products = db.product;\r\n\r\nexport default class productsBase {\r\n    constructor() {\r\n        if (process.env.ENVIROMENT === 'production' && new.target === productsBase) {\r\n            throw new TypeError(\"Cannot construct Abstract instances directly\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets all products from the database.\r\n     */\r\n    async getAllProducts() {\r\n        try {\r\n            let allProducts = await products.findAll();\r\n\r\n            if (allProducts.length <= 0) {\r\n                return {\r\n                    msg: 'No products found..',\r\n                    payload: 1\r\n                }\r\n            }\r\n\r\n            let productList = allProducts.map((item, index, arr) => {\r\n                return {\r\n                    product: item.dataValues,\r\n                    index: index\r\n                };\r\n            });\r\n\r\n            return {\r\n                msg: 'Success',\r\n                payload: 0,\r\n                productList: productList\r\n            }\r\n        } catch (e) {\r\n            return {\r\n                msg: 'An error occurred while trying to get the products list',\r\n                payload: 1\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a specific product by it's Unique Identifier.\r\n     * @param id\r\n     */\r\n    async getProductById(id) {\r\n        let product = await products.findAll({\r\n            where: {\r\n                id: id\r\n            }\r\n        });\r\n\r\n        if (product.length <= 0) {\r\n            return {\r\n                msg: 'No product was found..',\r\n                payload: 1\r\n            }\r\n        }\r\n\r\n        return {msg: 'Success', payload: 0, product: product[0].dataValues};\r\n    }\r\n\r\n    /**\r\n     * Creates a new instance of product.\r\n     *\r\n     * status: 0 draft, 1 live\r\n     *\r\n     * @param name\r\n     * @param description\r\n     * @param thumbnail\r\n     * @param dispatchTime\r\n     * @param status\r\n     * @param eligibleForDiscount\r\n     * @param productInventory\r\n     * @param startSaleDate\r\n     * @param endSaleDate\r\n     */\r\n    async createProduct(name, description, thumbnail, dispatchTime, status, eligibleForDiscount, productInventory, startSaleDate, endSaleDate) {\r\n        try {\r\n            let createdProduct = await products.create({\r\n                productName: name,\r\n                productDesc: description,\r\n                productThumbnail: thumbnail,\r\n                productDispatchTime: dispatchTime,\r\n                status: status,\r\n                eligibleForDiscount: eligibleForDiscount,\r\n                productInventory: productInventory,\r\n                startSale: startSaleDate,\r\n                endSale: endSaleDate\r\n            });\r\n\r\n            return {msg: 'Success', payload: 0, insertedId: createdProduct.dataValues.id};\r\n        } catch (e) {\r\n            return {msg: 'An error occurred while trying to create a new product', payload: 1};\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a paginated partial view of the products catalog.\r\n     * @todo Needs further testing to assure that pagination works as intended.\r\n     * @param page\r\n     */\r\n    async getProductsByPagination(page) {\r\n        try {\r\n            let count = await products.findAndCountAll().then((data) => {\r\n                return data.count;\r\n            });\r\n\r\n            const limit = 50;\r\n\r\n            let pages = Math.ceil(count / limit);\r\n            let offset = limit * (page - 1);\r\n\r\n            let resultObjects = await products.findAll({\r\n                order: [\r\n                    ['id', 'DESC']\r\n                ],\r\n                limit: limit,\r\n                offset: offset\r\n            });\r\n\r\n            if (resultObjects.length <= 0) {\r\n                return {msg: 'There was no products found...', payload: 1};\r\n            }\r\n\r\n            let outputProducts = resultObjects.map((item, index) => {\r\n                return item.dataValues;\r\n            });\r\n\r\n            return {\r\n                msg: 'Success',\r\n                payload: 0,\r\n                pages: pages,\r\n                count: count,\r\n                products: outputProducts\r\n            };\r\n        } catch (e) {\r\n            return {msg: 'An error occurred while trying get a set of paginated products..', payload: 1};\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update information about a product.\r\n     * @param id\r\n     * @param name\r\n     * @param description\r\n     * @param thumbnail\r\n     * @param dispatchTime\r\n     * @param status\r\n     * @param eligibleForDiscount\r\n     * @param productInventory\r\n     * @param startSaleDate\r\n     * @param endSaleDate\r\n     */\r\n    async updateProductById(id, name, description, thumbnail, dispatchTime, status, eligibleForDiscount, productInventory, startSaleDate, endSaleDate) {\r\n        try {\r\n            let updatedProduct = await !!products.update({\r\n                    productName: name,\r\n                    productDesc: description,\r\n                    productThumbnail: thumbnail,\r\n                    productDispatchTime: dispatchTime,\r\n                    status: status,\r\n                    eligibleForDiscount: eligibleForDiscount,\r\n                    productInventory: productInventory,\r\n                    startSale: startSaleDate,\r\n                    endSale: endSaleDate\r\n                },\r\n                {\r\n                    where: {\r\n                        id: id\r\n                    }\r\n                });\r\n\r\n            if (!updatedProduct) {\r\n                return {msg: 'The product was not able to be updated.', payload: 1};\r\n            }\r\n\r\n            return {msg: 'Success', payload: 0};\r\n        } catch (e) {\r\n            return {msg: 'An error occurred while updating the product information.', payload: 1};\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * Soft delete a product.\r\n     * @param id\r\n     */\r\n    async deleteProduct(id) {\r\n\r\n        if (!id) {\r\n            return {msg: 'No Id specified..', payload: 1};\r\n        }\r\n\r\n        try {\r\n            return !!await products.destroy({\r\n                where: {\r\n                    id: id\r\n                }\r\n            });\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n\r\n    }\r\n}\r\n"]}